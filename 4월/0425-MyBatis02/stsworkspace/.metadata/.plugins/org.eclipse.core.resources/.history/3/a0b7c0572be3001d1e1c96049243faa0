package com.mvc.controller;

import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

import com.mvc.service.BoardService;
import com.mvc.vo.Board;
import com.mysql.cj.jdbc.exceptions.MysqlDataTruncation;

@Controller
public class BoardController {
	@Autowired
	BoardService service;
	private final Logger logger = LoggerFactory.getLogger(BoardController.class);

	@RequestMapping(value = { "/list","/" }, method = RequestMethod.GET)
	public String selectAll(Model model)throws Exception {// Map(key, value)
//		System.out.println("list...");
		List<Board> list = service.selectAll();

		model.addAttribute("list", list);
		return "list";// view name
	}	

	@GetMapping(value = "/read")
	public String read(Model model, @RequestParam("num") String num)throws Exception  {
		//int a = 2/0;
		Board b = service.selectOne(num);

		model.addAttribute("b", b);
		return "read";// view name
	}
	
	@GetMapping(value = "/modify")
	public String modify(Model model, String num)throws Exception  {	
		Board b = service.selectOne(num);
		model.addAttribute("b", b);
		return "modify";// view name
	}
	
	@PostMapping(value = "/modifyProcess")
	public String modifyProcess(Board b)throws Exception  {
		service.modify(b);
		return "redirect:/list";// view name
	}

	@GetMapping(value = "/insertForm") // �엯�젰�솕硫�
	public String insertForm() {
		return "insertForm";// view name
	}

	// @ModelAttribute: �겢�씪�씠�뼵�듃媛� �엯�젰�븳 媛믪쓣 媛앹껜(vo)濡� 諛쏆븘�삤湲� �쐞�븳 annotation
	@PostMapping(value = "/insertProcess") // db�뿉 �엯�젰
	public String insertProcess(@ModelAttribute Board b) throws Exception {// vo. �궗�슜�옄媛� �엯�젰�븳 媛� 4媛쒕�� 諛쏆븘�샂.�엯�젰�솕硫댁쓽 移몄씠由꾧낵 vo�쓽 �븘�뱶紐낆씠 �씪移섑빐�빞 �븿.

		service.insert(b);
		return "redirect:/list";// redirect
	}

	@GetMapping(value = "/delete")
	public String delete(Model model, String num)throws Exception  {
		
		service.delete(num);
		return "redirect:/list";// view name
	}
	
	
	
	@ExceptionHandler(Exception.class)
	public ModelAndView handleException(Exception ex) {
		ModelAndView mnv = new ModelAndView();
		System.out.println(ex.getClass().getName());
		// if (e instanceof ArithmeticException) { }
		mnv.addObject("msg", "do well!!!");
		mnv.setViewName("error/error");
		return mnv;
	}
	
	/*
	 * 
	 * @ExceptionHandler �뒗 @Controller , @RestController 媛� �쟻�슜�맂 Bean �뿉�꽌 諛쒖깮�븯�뒗 �삁�쇅瑜� �옟�븘�꽌 �븯�굹�쓽 硫붿꽌�뱶�뿉�꽌 泥섎━�빐二쇰뒗 湲곕뒫�씠�떎.
	 * @ExceptionHandler �뿉 �꽕�젙�븳 �삁�쇅媛� 諛쒖깮�븯硫� handler媛� �떎�뻾�맂�떎. 
	 * @Controller, @RestController媛� �븘�땶 @Service �굹 @Repository 媛� �쟻�슜�맂 Bean�뿉�꽌�뒗 �궗�슜�븷 �닔 �뾾�떎. 
	 *  
	@ExceptionHandler(Exception.class)
	public ModelAndView handleException(Exception e) {
		ModelAndView mnv = new ModelAndView();
		// �빐而� 怨듦꺽�쓽 鍮뚮�몃�� �젣怨듯븷 �닔 �엳�쓬�쑝濡� �꽌踰꾩뿉�꽌 諛쒖깮�븳 援ъ껜�쟻�씤 �삤瑜섎�� �몴�떆�븯吏��뒗 �븡�뒗�떎.
		System.out.println(e.getClass().getName());
		// if (e instanceof ArithmeticException) { }
		mnv.addObject("errmsg", "do well!!!");
		// �삁�쇅媛� 諛쒖깮�릺硫� /error/err�쓣 �샇異쒗븳�떎.
		mnv.setViewName("error/error");
		return mnv;
	}
	*/

}
