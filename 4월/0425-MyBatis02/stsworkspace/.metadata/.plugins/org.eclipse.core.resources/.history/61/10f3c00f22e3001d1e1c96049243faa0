package com.mvc.controller;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import com.mvc.service.UserService;
import com.mvc.vo.User;

@Controller
public class UserController {
	
	@Autowired
	UserService service;
	
	@GetMapping(value = "/loginForm")
	public String login() { // 濡쒓렇�씤 �솕硫�
		return "loginForm";// view name
	}

	@PostMapping(value = "/loginProcess")
	public String login2(HttpSession session, String id, String pass, String admin, RedirectAttributes ra) throws Exception {// id, pass 諛쏆븘���꽌 db�뿉 媛��꽌 泥댄겕 �븳 �썑�뿉 �꽭�뀡�뿉 ���옣
		
			User user = new User(id, pass);
			boolean flag = service.check(user);
			String url = "list";// ok
			System.out.println(flag);
			if (flag) {// 濡쒓렇�씤 �꽦怨�
				
				if(admin != null) {
					session.setAttribute("admin", "admin");				
				}
				
				session.setAttribute("user", user);
				/* cookie 泥섎━---------------
				if (remember != null) {// 泥댄겕諛뺤뒪 泥댄겕�븳 寃쎌슦
					Cookie remem = new Cookie("remem", id);
					remem.setMaxAge(-1);
					response.addCookie(remem);

				} else {// 泥댄겕諛뺤뒪 �뫜 寃쎌슦
						// �쑀�슚�븯吏� �븡�� 荑좏궎濡� �꽕�젙�븯湲�
					Cookie cookie = new Cookie("remem", "");
					cookie.setMaxAge(0); // �쑀�슚�븯吏� �븡�� 荑좏궎
					response.addCookie(cookie);
				}
				*/
			} else { // 濡쒓렇�씤 �떎�뙣	
				//�꽭�뀡�쓣 �씠�슜�븯湲� �븣臾�. �떒, 1�쉶�슜�씠湲� �븣臾몄뿉 redirect �릺硫� �궗�씪吏꾨떎.�쟾�떖�맂 Parameter�뒗 URL�뿉 �끂異쒕릺吏� �븡�뒗�떎.
				ra.addFlashAttribute("errormsg", "ID/PW瑜� �솗�씤�빐 二쇱꽭�슂!");//諛붾줈 ${errormsg}濡� 爰쇰궡�꽌 ��.addFlashAttribute �쓽 寃쎌슦 �뜲�씠��媛� post �삎�떇�쑝濡� �쟾�떖�씠 �맂�떎.
				//ra.addAttribute("aa", "ID/PW瑜� aaa 二쇱꽭�슂!");// �뜲�씠��媛� URI�뿉 �끂異�. param�쑝濡� �쟾�떖�맖 ${param.aa}. get
				url = "loginForm";
			}
		
		return "redirect:/" + url;// view name
	}

	@GetMapping(value = "/logout")
	public String logout(HttpSession session) {// �꽭�뀡�뿉t
		session.setAttribute("user", null);
		session.setAttribute("admin", null);
		
		return "redirect:/list";// view name
	}
}


